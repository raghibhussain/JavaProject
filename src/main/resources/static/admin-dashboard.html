<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/dashboard.css">
</head>

<body>

<div class="dashboard">

  <!-- ========== SIDEBAR ========== -->
  <div class="sidebar">

    <!-- Profile -->
    <div class="profile text-center">
      <img src="https://i.pravatar.cc/100" alt="profile">
      <h5 id="sidebarName">Admin</h5>
      <small id="sidebarRole">ADMIN</small>
    </div>

    <!-- Menu -->
    <div class="menu">
      <a href="#">Dashboard</a>
      <a href="#">Users</a>
      <a href="#">Settings</a>
      <a href="#" onclick="logout()" class="logout">Logout</a>
    </div>

  </div>

  <!-- ========== MAIN CONTENT ========== -->
  <div class="content">

    <h2>Admin Dashboard</h2>
    <p>Welcome Admin.</p>

    <!-- USERS TABLE -->
    <h4 class="mt-4">All Users</h4>

    <table class="table table-bordered table-hover mt-3">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="usersTableBody">
        <!-- Users will load here -->
      </tbody>
    </table>

  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ================= AUTH CHECK ================= */
const user = JSON.parse(localStorage.getItem("loggedInUser"));

if (!user || user.role !== "ADMIN") {
  window.location.href = "login.html";
}

/* ================= SIDEBAR DATA ================= */
document.getElementById("sidebarName").innerText = user.name;
document.getElementById("sidebarRole").innerText = user.role;

/* ================= LOAD USERS ================= */
fetch("http://localhost:8080/admin/users")
  .then(response => response.json())
  .then(users => {

    const tableBody = document.getElementById("usersTableBody");
    tableBody.innerHTML = "";

    users.forEach(u => {
      const row = `
        <tr>
          <td>${u.id}</td>
          <td>${u.name}</td>
          <td>${u.email}</td>
          <td>${u.role}</td>
          <td>
            <button class="btn btn-danger btn-sm"
              onclick="deleteUser(${u.id})">
              Delete
            </button>
          </td>
        </tr>
      `;
      tableBody.innerHTML += row;
    });

  })
  .catch(err => {
    console.error("Error loading users", err);
  });

/* ================= DELETE USER ================= */
function deleteUser(userId) {

  const confirmDelete = confirm("Are you sure you want to delete this user?");
  if (!confirmDelete) return;

  fetch(`http://localhost:8080/admin/users/${userId}`, {
    method: "DELETE"
  })
  .then(response => {
    if (response.ok) {
      alert("User deleted successfully");
      location.reload();
    } else {
      alert("Error deleting user");
    }
  });
}

/* ================= LOGOUT ================= */
function logout() {
  const confirmLogout = confirm("Are you sure you want to logout?");
  if (confirmLogout) {
    localStorage.removeItem("loggedInUser");
    window.location.href = "index.html";
  }
}
</script>

</body>
</html>
